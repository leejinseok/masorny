<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title></title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
</head>
<body>



<style media="screen">
html{
    box-sizing: border-box;
}
*, *:before, *:after {
    box-sizing: inherit;
}
.masorny{
    width:1200px;
    background-color: red;
    background: #eee;
    position:relative;
    margin:auto;
    display:block;
}
.masorny .column{
    position:absolute;
    width:25%;
    padding:.5em;
}

.masorny .column p:first-child{
    margin-bottom: 3px;
}
.masorny .column .title{
    padding:.3em;
    padding-top:0em;
    font-size:12px;
}
.masorny .column img{
    width:100%;
    border-radius:5px;
}

@media only screen and (max-width:1226px){
    .masorny{
        width:100%;
    }
}
@media only screen and (max-width:800px){
    .masorny .column{
        width:50%;
    }
}
@media only screen and (max-width:445px){
    .masorny .column{
        width:100%;
    }
}
</style>
<div class="masorny">
    <div class="column">
        <p><img src="http://ec2-52-78-217-28.ap-northeast-2.compute.amazonaws.com/uploaded/posts/2.png"></p>
        <div class="title">
            Rabbit & Bear
            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
        </div>
    </div>
    <div class="column">
        <p><img src="http://ec2-52-78-217-28.ap-northeast-2.compute.amazonaws.com/uploaded/posts/3.png"></p>
        <div class="title">
            Amazing natural
        </div>
    </div>
    <div class="column">
        <p><img src="http://ec2-52-78-217-28.ap-northeast-2.compute.amazonaws.com/uploaded/posts/4.png"></p>
        <div class="title">
            The Mermaid and the Boy.
        </div>
    </div>
    <div class="column">
        <p><img src="http://ec2-52-78-217-28.ap-northeast-2.compute.amazonaws.com/uploaded/posts/5.png"></p>
        <div class="title">
            insect
        </div>
    </div>
    <div class="column">
        <p><img src="http://ec2-52-78-217-28.ap-northeast-2.compute.amazonaws.com/uploaded/posts/6.png"></p>
        <div class="title">
            The Enchanted Wreath; illustration from the Orange Fairy Book by Tomislav Tomic

        </div>
    </div>
    <div class="column">
        <p><img src="http://ec2-52-78-217-28.ap-northeast-2.compute.amazonaws.com/uploaded/posts/7.png"></p>
        <div class="title">
            1912 Fairie Tale Art From "In Powder and Crinoline"
        </div>
    </div>
    <div class="column">
        <p><img src="http://ec2-52-78-217-28.ap-northeast-2.compute.amazonaws.com/uploaded/posts/8.png"></p>
        <div class="title">
            1912 Fairie Tale Art From "In Powder and Crinoline"
        </div>
    </div>
    <div class="column">
        <p><img src="http://ec2-52-78-217-28.ap-northeast-2.compute.amazonaws.com/uploaded/posts/10.png"></p>
        <div class="title">
            Walt Disney designed emblems for WWII planes and submarines.
        </div>
    </div>
</div>
<script type="text/javascript">

var gapTop = 16;
function masorny_init(column_count){
    var column_count = column_count;

    $column = $(".masorny").find('.column');
    $len = $column.length;

    for($i=0;$i<$len;$i++){
        $img = $($column[$i]).find('img');
        // $height = $img.height;
        $height = $($column[$i]).height();
        $left = getLeft($i, column_count);
        $($column[$i]).css('left', $left);
        //top set
        if($i<column_count){
            $($column[$i]).css('top', '0px');
        }
        if($i>column_count-2){
            $loop=true;
            $top=0;
            $find_idx = $i;
            while($loop){
                $find_idx = $find_idx-column_count;
                $img = $($column[$find_idx]).find('img');
                if($img.length > 0){
                    // $height = $img[0].height;
                    $height = $($column[$find_idx]).height();
                    $top += $height;
                    $top += gapTop;
                }
                else{
                    $loop = false;
                }
            }
            $($column[$i]).css('top', $top+'px');
        }
    }//end for

    //get height
    var heights = [];
    for($j=0;$j<column_count;$j++){
        // heights[$j] = $($column[$j]).height();
        heights[$j] = 0;
        // console.log(heights[$j]);
        for($jj=0;$jj<$len/column_count;$jj++){
            // console.log($($column[$j*$jj+column_count]).height());
            var idx = $j*$jj+(column_count*$jj);
            heights[$j] +=  $($column[idx]).height();
            heights[$j] += gapTop;

        }
    }
    var maxHeight =getMaxOfArray(heights);
    $(".masorny").css('height', maxHeight);

};

function getMaxOfArray(numArray) {
  return Math.max.apply(null, numArray);
}

// console.log($column[0]);
window.addEventListener('resize', function(evt){
    var innerWidth = evt.target.innerWidth;
    if(innerWidth < 445){
        masorny_init(1);
    }
    else if(innerWidth < 800){
        // masorny_resize();
        masorny_init(2);
    }
    else if(innerWidth > 800){
        masorny_init(4);
    }
})

window.addEventListener('load', function(){
    var innerWidth = $(window).width();
    if(innerWidth < 445){
        masorny_init(1);
    }
    else if(innerWidth < 800){
        masorny_init(2);
    }
    else if(innerWidth > 800){
        masorny_init(4);
    }
})

function getLeft(idx, column_count) {
    var left = "0%";
    if(column_count == 4){
        switch($i%column_count){
            case 0 : left =  '0%';break;
            case 1 : left = '25%';break;
            case 2 : left = '50%';break;
            case 3 : left = '75%';break;
        }
    }
    else if(column_count == 2){
        switch($i%column_count){
            case 0 : left =  '0%';break;
            case 1 : left = '50%';break;
        }
    }
    return left;
}

masorny_init();


</script>
</body>
</html>
